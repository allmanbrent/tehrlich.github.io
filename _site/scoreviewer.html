<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Score Viewer for Glass</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/css/syntax.css">

        <!-- Custom CSS/JS-->
        <link href='http://fonts.googleapis.com/css?family=Lato:400,700,300,100' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="/css/bootstrap.css">
        <link rel="stylesheet" href="/css/bootstrap-responsive.css">
        <link rel="stylesheet" href="/css/style.css">
        <link rel="stylesheet" href="/css/prettyPhoto.css" />
        <link rel="shortcut icon" href="/favicon.ico">
        <script src="/js/googleanalytics.js"></script>
        <script src="/js/jquery-1.7.1.js"></script>
        <script src="/js/bootstrap.min.js"></script>
        <script src="/js/jquery.easing.1.3.js"></script>
        <script src="/js/jquery.custom.js"></script>
        <script src="/js/jquery.quicksand.js"></script>
    </head>
    <body>
  <div class="wrapper">
    <div class="masthead">
      <div class="container">
      <!-- button for small devices-->
      <div class="row no-margin"><div class="span12"><div class="hidden-desktop">
      <a class="btn btn-navbar"  data-toggle="collapse" data-target=".nav-collapse"><span class="icon-align-justify"></span></a></div>
      <div class="brand"> <a href="/">tylerehrlich.com</a></div>
      <!-- navigation -->
      <div class="navbar main-nav"><div class="nav-collapse collapse" >
         <ul class="nav pull-right ">
          <li><a href="/posts">Blog</a></li>
          <!--<li><a href="/about">About</a></li>-->
          <li><a href="/cv.pdf">CV (PDF)</a></li>
          <li><a href="/contact">Contact</a></li>
        </ul>
        </div></div></div></div>
        <!-- end navigation -->
      </div>
      <!-- end container -->
    </div>
    <!-- end header-->
                <div class="container clearfix">
	<div class="span12">
		<h3 class="intro">Score Viewer for Glass</h3>
		<p class="meta">04 Jan 2014</p>
	</div>
<div class="row">
      <div class="span3 bs-docs-sidebar">
        <ul class="nav nav-list bs-docs-sidenav">
       	  
       	  	
          	<li class="active"><a href="/scoreviewer.html"><i class="icon-chevron-right"></i>Score Viewer for Glass</a></li>
          	 
          
       	  	
          	<li><a href="/photostreaming.html"><i class="icon-chevron-right"></i>Streaming Photos from Glass</a></li>
    		
          
       	  	
          	<li><a href="/gazebo-errata.html"><i class="icon-chevron-right"></i>Gazebo Dances: Errata</a></li>
    		
          
       	  	
          	<li><a href="/Sweeney-Todd-Through-Glass.html"><i class="icon-chevron-right"></i>Sweeney Todd Through Glass</a></li>
    		
          
       	  	
          	<li><a href="/BeatKeeper1.html"><i class="icon-chevron-right"></i>BeatKeeper Version 1.0</a></li>
    		
          
       	  	
          	<li><a href="/spelling-bee-errata.html"><i class="icon-chevron-right"></i>Spelling Bee: Errata</a></li>
    		
          
       	  	
          	<li><a href="/gazebo-plan.html"><i class="icon-chevron-right"></i>Gazebo Dances: Rehearsal Schedule</a></li>
    		
          
        </ul>
      </div>
      <div class="span9">
      <p><i>This was originally written for my thesis, available <a href="thesis.pdf">here</a>.</i></p>

<p>After spending weeks looking into Android PDF libraries, the Mirror API seemed like a much more logical choice to use to deploy a musical score. Google supports several programming languages to use with the API: Go, Java, .NET, PHP, Python, and Ruby. Due to curiosity and a fondness for the language, I decided to use Python.</p>

<p>After downloading the quick start project, I created an application on Google App Engine. Since this application was designed to contain <i>Armenian Dances</i> by Aram Khachaturian, the application was titled “CUWindsKach” and is accessible at: [http://cuwindskach.appspot.com]. After editing <code>client_secrets.json</code>, generating a <code>session.secret</code> file to store session cookies, and editing <code>app.yaml</code> to include the name of the application, the Python application was ready to deploy.</p>

<p>Once it was launched, the next step was including the scores. After scanning in the condensed score, I divided it up into 640x360 images, the size of Glass&#39;s display, using Photoshop. A simple form hooked into the Python application to send the image.</p>

<p>Here is the form that serves the image to the backend:</p>

<div class="highlight"><pre><code class="html"> <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">&quot;/&quot;</span> <span class="na">method=</span><span class="s">&quot;post&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;hidden&quot;</span> <span class="na">name=</span><span class="s">&quot;operation&quot;</span> <span class="na">value=</span><span class="s">&quot;insertItem&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;hidden&quot;</span> <span class="na">name=</span><span class="s">&quot;message&quot;</span> <span class="na">value=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;hidden&quot;</span> <span class="na">name=</span><span class="s">&quot;imageUrl&quot;</span> <span class="na">value=</span><span class="s">&quot;/static/images/1.jpg&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;hidden&quot;</span> <span class="na">name=</span><span class="s">&quot;contentType&quot;</span> <span class="na">value=</span><span class="s">&quot;image/jpeg&quot;</span><span class="nt">&gt;</span>

      <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">&quot;btn btn-block&quot;</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span><span class="nt">&gt;</span>
        Insert page 1
        <span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">&quot;button-icon&quot;</span> <span class="na">src=</span><span class="s">&quot;/static/images/1.jpg&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;/button&gt;</span>
    <span class="nt">&lt;/form&gt;</span>
</code></pre></div>

<p>Here is the backend Python code that processes the HTML form.</p>

<div class="highlight"><pre><code class="python"><span class="k">def</span> <span class="nf">_insert_item</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="sd">&quot;&quot;&quot;Insert a timeline item.&quot;&quot;&quot;</span>
<span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;Inserting timeline item&#39;</span><span class="p">)</span>
<span class="n">body</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c"># this is slightly unnecessary, as the two levels are null and default</span>
    <span class="s">&#39;notification&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;level&#39;</span><span class="p">:</span> <span class="s">&#39;DEFAULT&#39;</span><span class="p">}</span> 
<span class="p">}</span>
<span class="c"># check if it&#39;s just text or if there markup</span>
<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;html&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;on&#39;</span><span class="p">:</span> 
  <span class="n">body</span><span class="p">[</span><span class="s">&#39;html&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;message&#39;</span><span class="p">)]</span>
<span class="k">else</span><span class="p">:</span>
  <span class="n">body</span><span class="p">[</span><span class="s">&#39;text&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;message&#39;</span><span class="p">)</span>

<span class="n">media_link</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;imageUrl&#39;</span><span class="p">)</span> 
<span class="k">if</span> <span class="n">media_link</span><span class="p">:</span> <span class="c"># see if media is present</span>
  <span class="k">if</span> <span class="n">media_link</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">):</span>
    <span class="n">media_link</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">get_full_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">media_link</span><span class="p">)</span>
  <span class="n">resp</span> <span class="o">=</span> <span class="n">urlfetch</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">media_link</span><span class="p">,</span> <span class="n">deadline</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
  <span class="n">media</span> <span class="o">=</span> <span class="n">MediaIoBaseUpload</span><span class="p">(</span>
      <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">content</span><span class="p">),</span> <span class="n">mimetype</span><span class="o">=</span><span class="s">&#39;image/jpeg&#39;</span><span class="p">,</span> <span class="n">resumable</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
  <span class="n">media</span> <span class="o">=</span> <span class="bp">None</span>
<span class="c"># self.mirror_service is initialized in util.auth_required.</span>
<span class="c"># insert into the timeline</span>
<span class="bp">self</span><span class="o">.</span><span class="n">mirror_service</span><span class="o">.</span><span class="n">timeline</span><span class="p">()</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">body</span><span class="o">=</span><span class="n">body</span><span class="p">,</span> <span class="n">media_body</span><span class="o">=</span><span class="n">media</span><span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span> 
<span class="k">return</span>  <span class="s">&#39;A timeline item has been inserted.&#39;</span>
</code></pre></div>

<p>Any user with Glass can navigate to this page and install the score to <i>Armenian Dances</i> on his or her Glass. It is possible to change this, however, using the settings in Google App Engine. One possible improvement for this application would be to bundle the images together. This way, if the user received a notification while they were installing the score, it would not be placed in between the pages in the score. Also, a single send button would be helpful; currently the user needs to click for each page of the score.</p>

<p>One clear limitation of Glass is the screen size. To combat this, Dr. Turner and I discussed the idea of a salient score that contains only the information necessary to conduct a work. As each conductor&#39;s needs are different, each individual would likely need to create his or her own salient score. This would allow the scores to be as minimalistic as possible. Below is one possible salient score of the opening of <i>Gazebo Dances</i>.</p>

<p><center><img src="img/salient.png" alt="Salient" style="width: 600px;"/></center></p>

<p>This score only contains time changes and other landmarks that are necessary to conduct the work. If a salient score is used in rehearsal, a full score is necessary to have nearby for reference.</p>

<p>To control page turns, a Bluetooth controller is optional, but recommended. To set this up, the native Android <code>Settings.apk</code> file must be sideloaded on the device. Dan McLaughlin&#39;s provides the file <a href="https://googledrive.com/host/0B3CzS-bH2NyETHNQZC1TbWh4RTQ/Settings.apk">here</a>. This application can then be started with the following command:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">adb shell am start -n com.android.settings/com.android.settings.Settings
</code></pre></div>
<p>After the control panel displays, it is possible to pair a keyboard or other Bluetooth device. After the pairing process is complete, pages can be navigated with the left and right arrows on the keyboard.</p>

<p>The source code for this project can be found online at <a href="https://github.com/tehrlich/scoreviewer">https://github.com/tehrlich/scoreviewer</a>. The application is also in production and accessible at <a href="http://cuwindskach.appspot.com">http://cuwindskach.appspot.com</a>.</p>

  </div>
</div>
</div>
    <div class="push"></div> <!-- Used for Sticky Footer -->
    </div>
    <!--page footer -->
  <div class="page-footer footer" id="footer">
      <div class="container ">
<ul class="nav pull-right ">
          <!--<li><a href="about.php">About</a></li>
          <li><a href="cv.pdf">CV (PDF)</a></li>
          <li><a href="contact.php">Contact</a></li>-->
        </ul>
        </div>
      </div> 
  </div>
      <!--scripts -->
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>
</body>
</html>